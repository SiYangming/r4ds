# R Markdown formats | R Markdown输出类型

## Introduction | 简介

So far you've seen R Markdown used to produce HTML documents. This chapter gives a brief overview of some of the many other types of output you can produce with R Markdown. There are two ways to set the output of a document:

迄今为止，我们已经知道了 R Markdown 可以生成 HTML 文档。本章将简单介绍 R Markdown 的一些其他类型的输出结果。设置 R Markdown 文档的输出类型的方式有 2 种。

1.  Permanently, by modifying the YAML header:  修改 YAML 文件头可以进行永久性设置。
    
    ```yaml
    title: "Viridis Demo"
    output: html_document
    ```
    
1.  Transiently, by calling `rmarkdown::render()` by hand: 手动调用 rmarkdown::render() 函数可以进行临时性设置。
    
    ```{r eval = FALSE}
    rmarkdown::render("diamond-sizes.Rmd", output_format = "word_document")
    ```
    
    This is useful if you want to programmatically produce multiple types of
    output.
    
    如果想要编程实现多种类型的输出，那么就需要使用这种设置方式。

RStudio's knit button renders a file to the first format listed in its `output` field. You can render to additional formats by clicking the dropdown menu beside the knit button.

RStudio 中的 knit 按钮可以按照 output 域中列出的第一种格式来输出文件。点击 knit 按钮旁的下拉菜单，也可以生成其他相应格式的输出。

```{r, echo = FALSE, out.width = NULL}
knitr::include_graphics("screenshots/rmarkdown-knit.png")
```

## Output options | 输出选项

Each output format is associated with an R function. You can either write `foo` or `pkg::foo`. If you omit `pkg`, the default is assumed to be rmarkdown. It's important to know the name of the function that makes the output because that's where you get help. For example, to figure out what parameters you can set with `html_document`, look at `?rmarkdown::html_document`.

每种输出类型对应一个 R 函数，使用 foo 或 pkg::foo 的函数调用形式都可以。如果省略pkg，R 会默认使用 rmarkdown 包。知道输出函数的名称是非常重要的，因为可以通过函数名获取帮助。例如，如果想要知道可以在 html_document() 函数中使用哪些参数，可以使用 ?rmarkdown::html_document() 来查看帮助。

To override the default parameter values, you need to use an expanded `output` field. For example, if you wanted to render an `html_document` with a floating table of contents, you'd use:

如果不想使用默认参数值，可以使用扩展的 output 域。例如，如果想要生成一个带有浮动表格内容的 html_document 文档，可以设置如下：

```yaml
output:
  html_document:
    toc: true
    toc_float: true
```

You can even render to multiple outputs by supplying a list of formats:

甚至还可以提供一个格式列表，以生成多种输出：

```yaml
output:
  html_document:
    toc: true
    toc_float: true
  pdf_document: default
```

Note the special syntax if you don't want to override any of the default options.

如果不想覆盖任何默认选项，注意一下特殊的语法。

## Documents | 文档

The previous chapter focused on the default `html_document` output. There are a number of basic variations on that theme, generating different types of documents:

上一章重点介绍了默认函数 html_document() 的输出，这个函数还有几个基本的变体，可以生成不同类型的文档。

*   `pdf_document` makes a PDF with LaTeX (an open source document layout 
    system), which you'll need to install. RStudio will prompt you if you 
    don't already have it.
    
    • pdf_document 可以使用 LaTeX（一种开源的文档排版系统）生成 PDF 文档。LaTeX 需要安装，如果没有安装，RStudio 会提醒你。
  
*   `word_document` for Microsoft Word documents (`.docx`). 可以生成 Microsoft Word 文档（.docx）。
  
*   `odt_document` for OpenDocument Text documents (`.odt`). 可以生成 OpenDocument Text 文档（.odt）。
  
*   `rtf_document` for Rich Text Format (`.rtf`) documents. 可以生成 Rich Text Format 文档（.rtf）。
  
*   `md_document` for a Markdown document. This isn't typically useful by 
    itself, but you might use it if, for example, your corporate CMS or
    lab wiki uses markdown.
    
    可以生成 Markdown 文档。这种文档本身不是很有用，但你可以将其与其他系统结合起来使用，如 CMS 系统或实验室 wiki。
    
*   `github_document`: this is a tailored version of `md_document` 
    designed for sharing on GitHub. 
    
    是 md_document 的一种定制版本，前者生成的文档可以在 GitHub 上分享。

Remember, when generating a document to share with decision makers, you can turn off the default display of code by setting global options in the setup chunk:

记住，当为决策者生成文档时，你应该在 setup 代码段中修改全局设置，关闭默认的显示代码选项：

```{r, eval = FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

For `html_document`s another option is to make the code chunks hidden by default, but visible with a click:

对于 html_document 文档，另一个选项可以让代码段默认是隐藏的，但点击鼠标后可见：

```yaml
output:
  html_document:
    code_folding: hide
```

## Notebooks | 笔记本

A notebook, `html_notebook`, is a variation on a `html_document`. The rendered outputs are very similar, but the purpose is different. A `html_document` is focused on communicating with decision makers, while a notebook is focused on collaborating with other data scientists. These different purposes lead to using the HTML output in different ways. Both HTML outputs will contain the fully rendered output, but the notebook also contains the full source code. That means you can use the `.nb.html` generated by the notebook in two ways:

笔记本文件是由 html_document 的变体 html_notebook() 函数生成的。虽然这两种函数生成的文件在格式上非常相似，但目的不同。html_document 主要用于与决策者进行沟通，而笔记本的主要用途则是与其他数据科学家协同工作。由于目的不同，HTML 输出文件的使用方式也不相同。这两种 HTML 输出文件都会包含全部结果，但笔记本中还包括完整的源代码。这意味着我们可以通过两种方式使用由 html_notebook() 生成的 .nb.html 文件。

1. You can view it in a web browser, and see the rendered output. Unlike
   `html_document`, this rendering always includes an embedded copy of 
   the source code that generated it.
   
   •	你可以使用网页浏览器来查看这种文件和分析结果。与 html_document 不同，这种文件始终包含了生成文件的源代码的一个嵌入式副本。

1. You can edit it in RStudio. When you open an `.nb.html` file, RStudio will
   automatically recreate the `.Rmd` file that generated it. In the future, you 
   will also be able to include supporting files (e.g. `.csv` data files), which 
   will be automatically extracted when needed. 
   
   •	你还可以在 RStudio 中编辑这种文件。当打开一个 .nb.html 文件时，Rstudio 会自动重建生成它的 .Rmd 文件。将来你还可以在这种文件中包含支持文件（如 .csv 数据文件），需要时可以自动提取出这些支持文件。

Emailing `.nb.html` files is a simple way to share analyses with your colleagues. But things will get painful as soon as they want to make changes. If this starts to happen, it's a good time to learn Git and GitHub. Learning Git and GitHub is definitely painful at first, but the collaboration payoff is huge. As mentioned earlier, Git and GitHub are outside the scope of the book, but there's one tip that's useful if you're already using them: use both `html_notebook` and `github_document` outputs:

通过电子邮件发送 .nb.html 文件是与同行分享分析结果的一种简单方式。但是，如果别人想修改这个文件，事情就变得不妙了。如果出现了修改文件的需求，是时候学习 Git 和GitHub 了。学习 Git 和 GitHub 的初期会非常痛苦，但合作带来的回报是非常丰厚的。正如我们在前面提到的，Git 和 GitHub 已经超出了本书的讨论范围，但如果你已经开始使用它们，我们会给你一个非常有用的提示：需要同时使用 html_notebook 和 github_document 两种输出形式。

```yaml
output:
  html_notebook: default
  github_document: default
```

`html_notebook` gives you a local preview, and a file that you can share via email. `github_document` creates a minimal md file that you can check into git. You can easily see how the results of your analysis (not just the code) change over time, and GitHub will render it for you nicely online.

html_notebook 可以在本地预览，还可以通过电子邮件进行分享。github_document 可以创建一个最简单的 MD 文件，你可以将其提交到 Git 中。你可以清晰地看到分析结果（不只是代码）是如何随时间的推移而不断发展的，GitHub 会在网上很好地呈现出这个过程。

## Presentations | 演示文稿

You can also use R Markdown to produce presentations. You get less visual control than with a tool like Keynote or PowerPoint, but automatically inserting the results of your R code into a presentation can save a huge amount of time. Presentations work by dividing your content into slides, with a new slide beginning at each first (`#`) or second (`##`) level header. You can also insert a horizontal rule (`***`) to create a new slide without a header. 

R Markdown 也可以生成演示文稿。与 Keynote 或 PowerPoint 这样的工具相 比，R Markdown 没有那么多视觉效果和控制方式，但它可以自动将R 代码的结果插入演示文稿， 这样可以节省大量时间。制作演示文稿的方法是将内容分为多个幻灯片，在每个一级标题（#）或二级标题（##）处开始一个新幻灯片。你也可以不使用标题来划分幻灯片，而是通过插入一条水平分隔线（***）来创建一张新的幻灯片。

R Markdown comes with three presentation formats built-in:
R Markdown 可以生成 3 种内置格式的演示文稿。

1.  `ioslides_presentation` - HTML presentation with ioslides 
ioslides 格式的 HTML 演示文稿。

1.  `slidy_presentation` - HTML presentation with W3C Slidy
W3C Slidy 格式的 HTML 演示文稿。

1.  `beamer_presentation` - PDF presentation with LaTeX Beamer.
LaTeX Beamer 格式的 PDF 演示文稿。

Two other popular formats are provided by packages:
此外，由其他 R 包提供的另外 2 种常用的演示文稿格式如下所示。

1.  `revealjs::revealjs_presentation` - HTML presentation with reveal.js. 
    Requires the __revealjs__ package.
    
    reveal.js 格式的 HTML 演示文稿。需要安装 revealjs 包。

1.  __rmdshower__, <https://github.com/MangoTheCat/rmdshower>, provides a 
    wrapper around the __shower__, <https://github.com/shower/shower>, 
    presentation engine
    
    提供了 shower 演示引擎的一个包装器。

## Dashboards | 仪表盘

Dashboards are a useful way to communicate large amounts of information visually and quickly. Flexdashboard makes it particularly easy to create dashboards using R Markdown and a convention for how the headers affect the layout:

仪表盘是沟通大量数据的一种快速而又直观的有效方法。flexdashboard 包可以非常轻松地使用 R Markdown 文件来创建仪表盘，它确定了使用标题控制仪表盘布局的约定。

* Each level 1 header (`#`) begins a new page in the dashboard.  • 每个一级标题（#）都可以在仪表盘中创建一个新页。
* Each level 2 header (`##`) begins a new column. • 每个二级标题（##）都可以创建一个新列。
* Each level 3 header (`###`) begins a new row. • 每个三级标题（###）都可以创建一个新行。

For example, you can produce this dashboard: •例如，要想创建以下这个仪表盘：

```{r, echo = FALSE, out.width = "75%"}
knitr::include_graphics("screenshots/rmarkdown-flexdashboard.png")
```

Using this code: 可以使用以下代码：

```{r comment = "", echo = FALSE}
cat(readr::read_file("rmarkdown/dashboard.Rmd"))
```

Flexdashboard also provides simple tools for creating sidebars, tabsets, value boxes, and gauges. To learn more about flexdashboard visit <http://rmarkdown.rstudio.com/flexdashboard/>.

flexdashboard 还提供了一些简单工具，用于创建工具栏、标签页、输入框和标尺。要想学习更多关于 flexdashboard 的知识，可以访问 http://rmarkdown.rstudio.com/flexdashboard/。

## Interactivity | 交互元素

Any HTML format (document, notebook, presentation, or dashboard) can contain interactive components.

HTML 格式（文档、笔记本、演示文稿或仪表盘）的所有文件都可以包含可交互组件。

### htmlwidgets

HTML is an interactive format, and you can take advantage of that interactivity with __htmlwidgets__, R functions that produce interactive HTML visualisations. For example, take the __leaflet__ map below. If you're viewing this page on the web, you can drag the map around, zoom in and out, etc. You obviously can't do that in a book, so rmarkdown automatically inserts a static screenshot for you.

HTML 是一种可交互的格式，要想利用这种交互性，你可以使用 htmlwidges，这是能够生成 HTML 可视化元素的一组 R 函数。例如，它可以生成以下的 leaflet 地图。如果在浏览器上查看这一页，就可以对地图进行拖动、放大、缩小等操作。显然，不能对图书进行这种操作，因此 rmarkdown 自动插入了一张静态的屏幕截图：

```{r}
library(leaflet)
leaflet() %>%
  setView(174.764, -36.877, zoom = 16) %>% 
  addTiles() %>%
  addMarkers(174.764, -36.877, popup = "Maungawhau") 
```

The great thing about htmlwidgets is that you don't need to know anything about HTML or JavaScript to use them. All the details are wrapped inside the package, so you don't need to worry about it.  

htmlwidgets 的优势是，无须了解任何关于 HTML 和 JavaScript 的知识就可以使用它们。因为所有细节都封装在包中，所以根本不需要关心细节。

There are many packages that provide htmlwidgets, including: 以下各包都可以提供 htmlwidgets。

* __dygraphs__, <http://rstudio.github.io/dygraphs/>, for interactive time 
  series visualisations. • dygraphs 可以实现交互式的时间序列可视化。

* __DT__, <http://rstudio.github.io/DT/>, for interactive tables. • DT 可以实现交互式表格。

* __threejs__, <https://github.com/bwlewis/rthreejs> for interactive 3d plots. • rthreejs 可以实现交互式三维图表。

* __DiagrammeR__, <http://rich-iannone.github.io/DiagrammeR/> for diagrams
  (like flow charts and simple node-link diagrams). • DiagrammeR 可以实现示意图（如流程图和简单的节点关联图）。

To learn more about htmlwidgets and see a more complete list of packages that provide them visit <http://www.htmlwidgets.org/>.

要想学习更多关于 htmlwidgets 的知识或查看提供 htmlwidgets 的完整 R 包列表，可以访问http://www.htmlwidgets.org/。

### Shiny

htmlwidgets provide __client-side__ interactivity --- all the interactivity happens in the browser, independently of R. On one hand, that's great because you can distribute the HTML file without any connection to R. However, that fundamentally limits what you can do to things that have been implemented in HTML and JavaScript.  An alternative approach is to use __shiny__, a package that allows you to create interactivity using R code, not JavaScript.

htmlwidgets 提供了客户端的交互性——所有交互都发生在浏览器中，与R 无关。这种方式有很明显的优点，因为你可以自由地分发 HTML 文件，不用考虑与 R 的连接。但这种方式的基本局限性在于，所有功能都要依靠 HTML 和 JavaScript 来实现。实现交互性的另一种方式是使用 Shiny，这个包可以使用 R 代码创建交互元素，而不用依靠 JavaScript。

To call Shiny code from an R Markdown document, add `runtime: shiny` to the header: 
如果想在 R Markdown 文档中调用 Shiny 代码，需要在文件头中添加 runtime::shiny：

```yaml
title: "Shiny Web App"
output: html_document
runtime: shiny
```

Then you can use the "input" functions to add interactive components to the document:
然后我们可以使用“输入”函数向文档中添加交互元素：

```{r, eval = FALSE}
library(shiny)

textInput("name", "What is your name?")
numericInput("age", "How old are you?", NA, min = 0, max = 150)
```
```{r, echo = FALSE, out.width = NULL}
knitr::include_graphics("screenshots/rmarkdown-shiny.png")
```
You can then refer to the values with `input$name` and `input$age`, and the code that uses them will be automatically re-run whenever they change. 
接下来，我们可以使用 input$name 和 input$age 来引用交互元素的值，如果值发生了改变，使用这些值的代码会自动重新运行。


I can't show you a live shiny app here because shiny interactions occur on the __server-side__. This means that you can write interactive apps without knowing JavaScript, but you need a server to run them on. This introduces a logistical issue: Shiny apps need a Shiny server to be run online. When you run shiny apps on your own computer, shiny automatically sets up a shiny server for you, but you need a public facing shiny server if you want to publish this sort of interactivity online. That's the fundamental trade-off of shiny: you can do anything in a shiny document that you can do in R, but it requires someone to be running R.

我们无法在这里展示一个实际的 Shiny 应用，因为 Shiny 的交互发生在服务器端。这意味着你可以在不使用 JavaScript 的情况下编写交互式应用，但需要一个服务器来运行这个应用。这就导致了一个逻辑问题：Shiny 应用需要一个 Shiny 服务器才能在线运行。当你在自己的计算机上运行 Shiny 应用时，Shiny 会自动建立一个 Shiny 服务器，但如果你想将这种交互式应用在网上公之于众，就需要面向公众的一个 Shiny 服务器。这就是使用 Shiny 时需要考虑的一个基本问题：可以在 Shiny 文件中实现 R 的所有功能，但代价是需要运行R 的一个服务器。

Learn more about Shiny at <http://shiny.rstudio.com/>. 要想学习更多关于 Shiny 的知识

## Websites | 网站

With a little additional infrastructure you can use R Markdown to generate a complete website:
如果再有一点基础设施，我们还可以使用 R Markdown 生成一个完整的网站。

*   Put your `.Rmd` files in a single directory. `index.Rmd` will become 
    the home page.
    •	将你的 .Rmd 文件放进一个单独的目录。index.Rmd 就可以作为网站的主页。

*   Add a YAML file named `_site.yml` provides the navigation for the site.
    For example:
    •	添加一个名为 _site.yml 的 YAML 文件来提供站点导航。例如：

    ```{r echo = FALSE, comment = ""}
    cat(readr::read_file("rmarkdown/example-site.yml"))
    ```

Execute `rmarkdown::render_site()` to build `_site`, a directory of files ready to deploy as a standalone static website, or if you use an RStudio Project for your website directory. RStudio will add a Build tab to the IDE that you can use to build and preview your site. 

运行 rmarkdown::render_site() 函数来建立 _site 目录，这个目录中包含了一个独立静态网站所需的所有文件。你还可以使用 RStudio Project 来建立网站目录，RStudio 会在 IDE 中添加一个 Build 标签页，你可以使用这个标签页来建立和预览自己的站点。

Read more at <http://rmarkdown.rstudio.com/rmarkdown_websites.html>.

要想学习更多这方面的知识，可以访问 https://rmarkdown.rstudio.com/rmarkdown_websites.html。

## Other formats | 其他类型

Other packages provide even more output formats: 其他包可以生成更多输出类型。

*   The __bookdown__ package, <https://github.com/rstudio/bookdown>, 
    makes it easy to write books, like this one. To learn more, read 
    [_Authoring Books with R Markdown_](https://bookdown.org/yihui/bookdown/),
    by Yihui Xie, which is, of course, written in bookdown. Visit
    <http://www.bookdown.org> to see other bookdown books written by the 
    wider R community.
    
    • bookdown 包可以使得编写图书更加容易，比如编写像本书这样的一本图书。如果想要了解更多，可以阅读谢益辉的著作 Authoring Books with R Markdown。当然，这本书也是通过 bookdown 编写的。R 社区中有很多利用 bookdown 编写的图书。

*   The __prettydoc__ package, <https://github.com/yixuan/prettydoc/>, 
    provides lightweight document formats with a range of attractive
    themes.
    
    • prettydoc 包提供了具有多个漂亮主题的轻量级文档格式。

*   The __rticles__ package, <https://github.com/rstudio/rticles>, compiles a
    selection of formats tailored for specific scientific journals.
    
    • rticles 包可以将 R Markdown 文件编译成一些科学杂志要求的特殊格式。

See <http://rmarkdown.rstudio.com/formats.html> for a list of even more formats.  You can also create your own by following the instructions at <http://rmarkdown.rstudio.com/developer_custom_formats.html>.

要想获得更多格式的列表，可以访问 http://rmarkdown.rstudio.com/formats.html。你也可以通过 http://bit.ly/CreatingNewFormats 上的操作指南创建自己的格式。

## Learning more | 更多学习资源

To learn more about effective communication in these different formats I recommend the following resources:

如果想要获取更多知识，以使用不同类型的输出进行有效沟通，那么我们推荐以下学习资源。

* To improve your presentation skills, I recommend 
  [_Presentation Patterns_](https://amzn.com/0321820800), by Neal Ford,
  Matthew McCollough, and Nathaniel Schutta. It provides a set of effective
  patterns (both low- and high-level) that you can apply to improve your 
  presentations.
  
  • 如果想要提高演示和表达能力，我们推荐你阅读 Neal Ford、Matthew McCollough 和Nathaniel Schutta 所著的 Presentation Patterns。这本书提供了（从低级到高级的）一整套有效的模式，可以帮助你提高自己的演示和表达能力。
  
* If you give academic talks, I recommend reading the [_Leek group guide
  to giving talks_](https://github.com/jtleek/talkguide).
  
  • 如果想要进行学术讨论，我们推荐你阅读一下 Leek group guide to giving talks 这本书。
  
* I haven't taken it myself, but I've heard good things about Matt 
  McGarrity's online course on public speaking: 
  <https://www.coursera.org/learn/public-speaking>.
  
  • 虽然我们没有亲身体验过，但 Matt McGarrity 关于公开演讲的在线课程（https://www. coursera.org/learn/public-speaking）确实具有良好的口碑。

* If you are creating a lot of dashboards, make sure to read Stephen Few's
  [Information Dashboard Design: The Effective Visual Communication 
  of Data](https://amzn.com/0596100167). It will help you create dashboards
  that are truly useful, not just pretty to look at.
  
  • 如果想要创建大量仪表盘，可以阅读 Stephen Few 所著的 Information Dashboard Design: The Effective Visual Communication of Data。这本书会帮助你创建真正有价值的仪表盘， 而不只是虚有其表的仪表盘。

* Effectively communicating your ideas often benefits from some
  knowledge of graphic design. [_The Non-Designer's Design
  Book_](http://amzn.com/0133966151) is a great place to start.
  
  • 平面设计知识经常有助于人们想法的有效沟通。《写给大家看的设计书》<https://www.ituring.com.cn/search?q=%E5%86%99%E7%BB%99%E5%A4%A7%E5%AE%B6%E7%9C%8B%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B9%A6> 是非常好的一本入门级图书。

